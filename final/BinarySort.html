<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Sort</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        canvas {
            border: 1px solid black;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
</head>
<body>
    <canvas id="myCanvas"></canvas>
    <script>
        const canvas = new fabric.Canvas('myCanvas', {
            width: 800,
            height: 600,
            backgroundColor: '#f0f0f0',
            selection: false
        });

        canvas.on('object:selected', function (e) {
            e.target.isMoving = false;
            e.target.stop();
        });

        canvas.on('selection:cleared', function () {
            canvas.getObjects().forEach(obj => {
                obj.isMoving = true;
                moveSquare(obj);
            });
        });

        // Function to create squares with AI behavior
        function createAISquare(color, x, y) {
            const square = new fabric.Rect({
                left: x,
                top: y,
                width: 50,
                height: 60,
                fill: color,
                selectable: true,
                hasControls: false,
                hasBorders: false,
                moving: true // Flag to track whether it's moving or not
            });

            // Add movement AI
            moveSquare(square);
            return square;
        }

        function createPen(color, x, y) {
            const pen = new fabric.Rect({
                left: x,
                top: y,
                width: 150,
                height: 200,
                fill: color,
                selectable: false
            });
            return pen;
        }
        
        const doorway = new fabric.Rect({
            left: canvas.width / 2 - 100,
            top: 0,
            width: 200,
            height: 100,
            fill: 'black',
            selectable: false
        });

const centralBox = {
    left: 150,
    top: 150,
    width: 500,
    height: 500
};

        function moveSquare(square) {
    		function loopMovement() {
        		if (!square.isMoving) { // Move only if not selected
            		const angle = Math.random() * 2 * Math.PI;
            		const distance = Math.random() * 50 + 10;
            		const delay = Math.random() * 1000 + 500;

            		const newLeft = Math.max(
                		0,
                		Math.min(canvas.width - square.width, square.left + Math.cos(angle) * distance)
            		);
            		const newTop = Math.max(
                		0,
                		Math.min(canvas.height - square.height, square.top + Math.sin(angle) * distance)
            		);

            		square.animate(
                		{ left: newLeft, top: newTop },
                		{
                    		duration: 400,
                    		onChange: canvas.renderAll.bind(canvas),
                    		onComplete: () => setTimeout(loopMovement, delay) // Repeat movement after delay
                		}
            		);
        		} else {
            		setTimeout(loopMovement, 100); // Check again after a short delay if not moving
        		}
    		}
    		loopMovement(); // Start the loop
		}


        // Square Color Logic
        const redSquare = createAISquare('red', 10, 10);
        const greenSquare = createAISquare('limegreen', 70, 10);
        const blueSquare = createAISquare('blue', 130, 10);
        const yellowSquare = createAISquare('gold', 190, 10);
        
        // Pen Color Logic
        const darkRedPen = createPen('darkred', 0, 0);
        const darkGreenPen = createPen('darkgreen', canvas.width - 150, 0);
        const darkBluePen = createPen('darkblue', 0, canvas.height - 200);
        const darkYellowPen = createPen('darkgoldenrod', canvas.width - 150, canvas.height - 200);

        // Add objects
        canvas.add(darkRedPen, darkGreenPen, darkBluePen, darkYellowPen);
        canvas.add(doorway);

        // Wave Spawner
        let burstCount = 0;
        const maxBursts = 4;

        function sendBurst() {
            if (burstCount >= maxBursts) return;

            // Send 4 AI squares to the center
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            for (let i = 0; i < 4; i++) {
                const angle = Math.random() * 2 * Math.PI;
                const distance = 50 + Math.random() * 100;

                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;

                const color = ['red', 'blue', 'limegreen', 'gold'][i];
                const newSquare = createAISquare(color, x, y);

                canvas.add(newSquare);
            }

            burstCount++;
        }

        // Trigger burst every 5 seconds
        setInterval(sendBurst, 500);
    </script>
</body>
</html>
